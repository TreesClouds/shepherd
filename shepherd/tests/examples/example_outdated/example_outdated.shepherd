READ LCM_TARGETS.SHEPHERD
RUN started = False
RUN names = []
RUN ids = []
WHILE not started
  WAIT SHEPHERD_HEADERS.PLAYER_JOINED FROM LCM_TARGETS.SHEPHERD WITH name = 'name' WITH id = 'id' OR SHEPHERD_HEADERS.NEXT_STAGE FROM LCM_TARGETS.SHEPHERD SET started = True
  RUN names.append(name)
  RUN ids.append(id)
  EMIT SERVER_HEADERS.PLAYERS TO LCM_TARGETS.SERVER WITH 'usernames' = names WITH 'recipients' = ids
  IF len(names) < 5 and started
    RUN started = False
    RUN num_players = len(names)
    EMIT SERVER_HEADERS.NOT_ENOUGH_PLAYERS TO LCM_TARGETS.SERVER WITH 'players' = num_players
  END
END
EMIT SERVER_HEADERS.CHANCELLOR_REQUEST TO LCM_TARGETS.SERVER WITH 'president' = names[0] WITH 'ineligibles' = []
ASSERT len(names) >= 5

WAIT SHEPHERD_HEADER.START_NEXT_STAGE FROM LCM_TARGETS.SHEPHERD OR SHEPHERD_HEADER.RESET_CURRENT_STAGE FROM LCM_TARGETS.SHEPHERD AND SHEPHERD_HEADER.RESET_MATCH FROM LCM_TARGETS.SHEPHERD
